ª
}C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddDbContext 
< #
FullMetalLibraryContext 5
>5 6
(6 7
options7 >
=>? A
options 
. 
UseSqlServer 
( 
builder  
.  !
Configuration! .
.. /
GetConnectionString/ B
(B C
$strC \
)\ ]
??^ `
throwa f
newg j&
InvalidOperationException	k „
(
„ …
$str
… ½
)
½ ¾
)
¾ ¿
)
¿ À
;
À Á
builder 
. 
Services 
. #
AddControllersWithViews (
(( )
)) *
;* +
builder 
. 
Services 
. 

AddSession 
( 
options #
=>$ &
{ 
options 
. 
IdleTimeout 
= 
TimeSpan "
." #
FromMinutes# .
(. /
$num/ 1
)1 2
;2 3
options 
. 
Cookie 
. 
HttpOnly 
= 
true "
;" #
options 
. 
Cookie 
. 
IsEssential 
=  
true! %
;% &
} 
) 
; 
builder 
. 
Services 
. "
AddHttpContextAccessor '
(' (
)( )
;) *
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
using 
( 
var 

scope 
= 
app 
. 
Services 
.  
CreateScope  +
(+ ,
), -
)- .
{ 
var 
services 
= 
scope 
. 
ServiceProvider (
;( )
SeedData 
. 

Initialize 
( 
services 
)  
;  !
} 
if"" 
("" 
!"" 
app"" 
."" 	
Environment""	 
."" 
IsDevelopment"" "
(""" #
)""# $
)""$ %
{## 
app$$ 
.$$ 
UseExceptionHandler$$ 
($$ 
$str$$ )
)$$) *
;$$* +
app&& 
.&& 
UseHsts&& 
(&& 
)&& 
;&& 
}'' 
app)) 
.)) 
UseHttpsRedirection)) 
()) 
))) 
;)) 
app** 
.** 
UseStaticFiles** 
(** 
)** 
;** 
app,, 
.,, 

UseRouting,, 
(,, 
),, 
;,, 
app.. 
... 

UseSession.. 
(.. 
).. 
;.. 
app00 
.00 
UseAuthorization00 
(00 
)00 
;00 
app22 
.22 
MapControllerRoute22 
(22 
name33 
:33 	
$str33
 
,33 
pattern44 
:44 
$str44 5
)445 6
;446 7
app66 
.66 
Run66 
(66 
)66 	
;66	 
¤A
…C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Models\SeedData.cs
	namespace 	
FullMetalLibrary
 
. 
Models !
{ 
public 

static 
class 
SeedData  
{ 
public

 
static

 
void

 

Initialize

 %
(

% &
IServiceProvider

& 6
serviceProvider

7 F
)

F G
{ 	
using 
var 
context 
= 
new  ##
FullMetalLibraryContext$ ;
(; <
serviceProvider 
.  
GetRequiredService  2
<2 3
DbContextOptions3 C
<C D#
FullMetalLibraryContextD [
>[ \
>\ ]
(] ^
)^ _
)_ `
;` a
Seed 
( 
context 
) 
; 
} 	
public 
static 
void 

Initialize %
(% &#
FullMetalLibraryContext& =
context> E
)E F
{ 	
Seed 
( 
context 
) 
; 
} 	
private 
static 
void 
Seed  
(  !#
FullMetalLibraryContext! 8
context9 @
)@ A
{ 	
if 
( 
context 
. 
Author 
. 
Any "
(" #
)# $
&&% '
context( /
./ 0
Book0 4
.4 5
Any5 8
(8 9
)9 :
): ;
return 
; 
var 
authorsToAdd 
= 
new "
[" #
]# $
{   
new!! 
Author!! 
{!! 
	FirstName!! &
=!!' (
$str!!) 2
,!!2 3
LastName!!4 <
=!!= >
$str!!? G
}!!H I
,!!I J
new"" 
Author"" 
{"" 
	FirstName"" &
=""' (
$str"") 2
,""2 3
LastName""4 <
=""= >
$str""? H
}""I J
,""J K
new## 
Author## 
{## 
	FirstName## &
=##' (
$str##) .
,##. /
LastName##0 8
=##9 :
$str##; C
}##D E
,##E F
new$$ 
Author$$ 
{$$ 
	FirstName$$ &
=$$' (
$str$$) 0
,$$0 1
LastName$$2 :
=$$; <
$str$$= G
}$$H I
,$$I J
new%% 
Author%% 
{%% 
	FirstName%% &
=%%' (
$str%%) 1
,%%1 2
LastName%%3 ;
=%%< =
$str%%> I
}%%J K
}&& 
;&& 
for(( 
((( 
int(( 
i(( 
=(( 
$num(( 
;(( 
i(( 
<(( 
authorsToAdd((  ,
.((, -
Length((- 3
;((3 4
i((5 6
++((6 8
)((8 9
{)) 
Author** 
?** 
author** 
=**  
authorsToAdd**! -
[**- .
i**. /
]**/ 0
;**0 1
if++ 
(++ 
!++ 
context++ 
.++ 
Author++ #
.++# $
Any++$ '
(++' (
a++( )
=>++* ,
a++- .
.++. /
	FirstName++/ 8
==++9 ;
author++< B
.++B C
	FirstName++C L
&&++M O
a++P Q
.++Q R
LastName++R Z
==++[ ]
author++^ d
.++d e
LastName++e m
)++m n
)++n o
{,, 
context-- 
.-- 
Author-- "
.--" #
Add--# &
(--& '
author--' -
)--- .
;--. /
}.. 
}// 
context00 
.00 
SaveChanges00 
(00  
)00  !
;00! "
var33 
authors33 
=33 
context33 !
.33! "
Author33" (
.33( )
ToList33) /
(33/ 0
)330 1
;331 2
var55 

booksToAdd55 
=55 
new55  
[55  !
]55! "
{66 
new77 
{77 
Title77 
=77 
$str77 8
,778 9
AuthorIndex77: E
=77F G
$num77H I
,77I J
PublishDate77K V
=77W X
new77Y \
DateTime77] e
(77e f
$num77f j
,77j k
$num77l m
,77m n
$num77o p
,77p q
$num77r s
,77s t
$num77u v
,77v w
$num77x y
,77y z
DateTimeKind	77{ ‡
.
77‡ ˆ
Utc
77ˆ ‹
)
77‹ Œ
,
77Œ 
Genre
77 ”
=
77” •
$str
77•  
,
77  ¡
	Available
77¢ «
=
77« ¬
true
77¬ °
}
77± ²
,
77² ³
new88 
{88 
Title88 
=88 
$str88 9
,889 :
AuthorIndex88; F
=88G H
$num88I J
,88J K
PublishDate88L W
=88X Y
new88Z ]
DateTime88^ f
(88f g
$num88g k
,88k l
$num88l m
,88m n
$num88n o
,88o p
$num88q r
,88r s
$num88t u
,88u v
$num88w x
,88x y
DateTimeKind	88z †
.
88† ‡
Utc
88‡ Š
)
88Š ‹
,
88‹ Œ
Genre
88Ž “
=
88“ ”
$str
88” œ
,
88œ 
	Available
88ž §
=
88§ ¨
true
88¨ ¬
}
88­ ®
,
88® ¯
new99 
{99 
Title99 
=99 
$str99 *
,99* +
AuthorIndex99, 7
=998 9
$num99: ;
,99; <
PublishDate99= H
=99I J
new99K N
DateTime99O W
(99W X
$num99X \
,99\ ]
$num99] ^
,99^ _
$num99_ `
,99` a
$num99b c
,99c d
$num99e f
,99f g
$num99h i
,99i j
DateTimeKind99k w
.99w x
Utc99x {
)99{ |
,99| }
Genre	99 „
=
99„ …
$str
99… Ž
,
99Ž 
	Available
99 ™
=
99™ š
false
99š Ÿ
}
99  ¡
}:: 
;:: 
foreach<< 
(<< 
var<< 
b<< 
in<< 

booksToAdd<< (
)<<( )
{== 
var>> 
authorId>> 
=>> 
authors>> &
[>>& '
b>>' (
.>>( )
AuthorIndex>>) 4
]>>4 5
.>>5 6
Id>>6 8
;>>8 9
if@@ 
(@@ 
!@@ 
context@@ 
.@@ 
Book@@ !
.@@! "
Any@@" %
(@@% &
book@@& *
=>@@+ -
book@@. 2
.@@2 3
Title@@3 8
==@@9 ;
b@@< =
.@@= >
Title@@> C
&&@@D F
book@@G K
.@@K L
AuthorId@@L T
==@@U W
authorId@@X `
)@@` a
)@@a b
{AA 
contextBB 
.BB 
BookBB  
.BB  !
AddBB! $
(BB$ %
newBB% (
BookBB) -
{CC 
TitleDD 
=DD 
bDD  !
.DD! "
TitleDD" '
,DD' (
AuthorIdEE  
=EE! "
authorIdEE# +
,EE+ ,
PublishDateFF #
=FF$ %
bFF& '
.FF' (
PublishDateFF( 3
,FF3 4
GenreGG 
=GG 
bGG  !
.GG! "
GenreGG" '
,GG' (
	AvailableHH !
=HH" #
bHH$ %
.HH% &
	AvailableHH& /
}II 
)II 
;II 
}JJ 
}KK 
contextMM 
.MM 
SaveChangesMM 
(MM  
)MM  !
;MM! "
}NN 	
}OO 
}PP â
ŽC:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Models\RegisterViewModel.cs
	namespace 	
FullMetalLibrary
 
. 
Models !
{ 
public 

class 
RegisterViewModel "
{ 
[ 	
Required	 
, 
StringLength 
(  
$num  "
)" #
]# $
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[

 	
Required

	 
,

 
EmailAddress

 
]

  
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
[ 	
Required	 
, 
DataType 
( 
DataType $
.$ %
Password% -
)- .
]. /
[ 	
StringLength	 
( 
$num 
, 
MinimumLength (
=) *
$num+ ,
,, -
ErrorMessage 
= 
$str	 
)
 ‚
]
‚ ƒ
[ 	
RegularExpression	 
( 
$str K
,K L
ErrorMessage 
= 
$str	 
)
 ‚
]
‚ ƒ
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
Required	 
, 
DataType 
( 
DataType $
.$ %
Password% -
)- .
]. /
[ 	
Compare	 
( 
$str 
, 
ErrorMessage )
=* +
$str, E
)E F
]F G
public 
string 
ConfirmPassword %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
} 
} Ä
‹C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Models\PasswordHelper.cs
	namespace 	
FullMetalLibrary
 
. 
Models !
{ 
public 

class 
PasswordHelper 
{ 
public 
static 
string 
HashPassword )
() *
string* 0
password1 9
)9 :
{		 	
byte

 
[

 
]

 
salt

 
=

 !
RandomNumberGenerator

 /
.

/ 0
GetBytes

0 8
(

8 9
$num

9 ;
)

; <
;

< =
string 
hashed 
= 
Convert #
.# $
ToBase64String$ 2
(2 3
KeyDerivation3 @
.@ A
Pbkdf2A G
(G H
password 
: 
password &
,& '
salt 
: 
salt 
, 
prf 
: 
KeyDerivationPrf )
.) *

HMACSHA256* 4
,4 5
iterationCount "
:" #
$num$ *
,* +
numBytesRequested %
:% &
$num' )
)) *
)* +
;+ ,
return 
$" 
{ 
Convert 
. 
ToBase64String ,
(, -
salt- 1
)1 2
}2 3
$str3 4
{4 5
hashed5 ;
}; <
"< =
;= >
} 	
public 
static 
bool 
VerifyPassword )
() *
string* 0
password1 9
,9 :
string; A

storedHashB L
)L M
{ 	
var 
parts 
= 

storedHash "
." #
Split# (
(( )
$char) ,
), -
;- .
if 
( 
parts 
. 
Length 
!= 
$num  !
)! "
return# )
false* /
;/ 0
var 
salt 
= 
Convert 
. 
FromBase64String /
(/ 0
parts0 5
[5 6
$num6 7
]7 8
)8 9
;9 :
var 
stored 
= 
parts 
[ 
$num  
]  !
;! "
string 
hashed 
= 
Convert #
.# $
ToBase64String$ 2
(2 3
KeyDerivation3 @
.@ A
Pbkdf2A G
(G H
password 
: 
password "
," #
salt   
:   
salt   
,   
prf!! 
:!! 
KeyDerivationPrf!! %
.!!% &

HMACSHA256!!& 0
,!!0 1
iterationCount"" 
:"" 
$num""  &
,""& '
numBytesRequested## !
:##! "
$num### %
)##% &
)##& '
;##' (
return%% 
stored%% 
==%% 
hashed%% #
;%%# $
}&& 	
}'' 
}(( í
‹C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Models\ErrorViewModel.cs
	namespace 	
FullMetalLibrary
 
. 
Models !
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 ´
‹C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Models\LoginViewModel.cs
	namespace 	
FullMetalLibrary
 
. 
Models !
{ 
public 

class 
LoginViewModel 
{ 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 5
)5 6
]6 7
[ 	
EmailAddress	 
( 
ErrorMessage "
=# $
$str% @
)@ A
]A B
[		 	
Display			 
(		 
Name		 
=		 
$str		 
)		  
]		  !
public

 
string

 
Email

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
=

* +
string

, 2
.

2 3
Empty

3 8
;

8 9
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 7
)7 8
]8 9
[ 	
DataType	 
( 
DataType 
. 
Password #
)# $
]$ %
[ 	
RegularExpression	 
( 
$str D
,D E
ErrorMessage 
= 
$str	 ‡
)
‡ ˆ
]
ˆ ‰
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
} 
} ÷
C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Models\Book.cs
	namespace 	
FullMetalLibrary
 
. 
Models !
{ 
public 

class 
Book 
{ 
[ 	
Key	 
] 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
[ 	
Required	 
] 
public 
string 
Title 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
public 
int 
AuthorId 
{ 
get !
;! "
set# &
;& '
}( )
[ 	

ForeignKey	 
( 
$str 
) 
]  
public 
Author 
? 
Author 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
DataType	 
( 
DataType 
. 
Date 
)  
]  !
public 
DateTime 
PublishDate #
{$ %
get& )
;) *
set+ .
;. /
}0 1
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str -
,- .
ErrorMessage/ ;
=< =
$str> r
)r s
]s t
public 
string 
Genre 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 
bool 
	Available 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} Œ
ƒC:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Models\Author.cs
	namespace 	
FullMetalLibrary
 
. 
Models !
{ 
public 

class 
Author 
{ 
[		 	
Key			 
]		 
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str +
,+ ,
ErrorMessage- 9
=: ;
$str< n
)n o
]o p
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str +
,+ ,
ErrorMessage- 9
=: ;
$str< m
)m n
]n o
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
	NotMapped	 
] 
public 
string 
Name 
=> 
$"  
{  !
	FirstName! *
}* +
$str+ ,
{, -
LastName- 5
}5 6
"6 7
.7 8
Trim8 <
(< =
)= >
;> ?
public 
ICollection 
< 
Book 
>  
Books! &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
=5 6
new7 :
List; ?
<? @
Book@ D
>D E
(E F
)F G
;G H
} 
} Á
‚C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Models\Admin.cs
	namespace 	
FullMetalLibrary
 
. 
Models !
{ 
public 

class 
Admin 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Required	 
, 
StringLength 
(  
$num  "
)" #
]# $
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
Required	 
, 
EmailAddress 
,  
StringLength! -
(- .
$num. 1
)1 2
]2 3
public 
string 
EmailAddress "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;@ A
[ 	
Required	 
, 
StringLength 
(  
$num  #
)# $
]$ %
[ 	
Display	 
( 
Name 
= 
$str "
)" #
]# $
[ 	
DataType	 
( 
DataType 
. 
Password #
)# $
]$ %
public 
string 
PasswordHash "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 
bool 
IsActive 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
true- 1
;1 2
[ 	
ScaffoldColumn	 
( 
false 
) 
] 
public 
DateTime 
	CreatedAt !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
DateTime2 :
.: ;
Now; >
;> ?
} 
} õG
C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Migrations\20250927030722_InitialCreate.cs
	namespace 	
FullMetalLibrary
 
. 

Migrations %
{ 
public		 

partial		 
class		 
InitialCreate		 &
:		' (
	Migration		) 2
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
UserName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: H
,H I
	maxLengthJ S
:S T
$numU W
,W X
nullableY a
:a b
falsec h
)h i
,i j
EmailAddress  
=! "
table# (
.( )
Column) /
</ 0
string0 6
>6 7
(7 8
type8 <
:< =
$str> M
,M N
	maxLengthO X
:X Y
$numZ ]
,] ^
nullable_ g
:g h
falsei n
)n o
,o p
PasswordHash  
=! "
table# (
.( )
Column) /
</ 0
string0 6
>6 7
(7 8
type8 <
:< =
$str> M
,M N
	maxLengthO X
:X Y
$numZ ]
,] ^
nullable_ g
:g h
falsei n
)n o
,o p
IsActive 
= 
table $
.$ %
Column% +
<+ ,
bool, 0
>0 1
(1 2
type2 6
:6 7
$str8 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
	CreatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= H
,H I
nullableJ R
:R S
falseT Y
)Y Z
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
Id8 :
): ;
;; <
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name   
:   
$str   
,   
columns!! 
:!! 
table!! 
=>!! !
new!!" %
{"" 
Id## 
=## 
table## 
.## 
Column## %
<##% &
int##& )
>##) *
(##* +
type##+ /
:##/ 0
$str##1 6
,##6 7
nullable##8 @
:##@ A
false##B G
)##G H
.$$ 

Annotation$$ #
($$# $
$str$$$ 8
,$$8 9
$str$$: @
)$$@ A
,$$A B
	FirstName%% 
=%% 
table%%  %
.%%% &
Column%%& ,
<%%, -
string%%- 3
>%%3 4
(%%4 5
type%%5 9
:%%9 :
$str%%; J
,%%J K
nullable%%L T
:%%T U
false%%V [
)%%[ \
,%%\ ]
LastName&& 
=&& 
table&& $
.&&$ %
Column&&% +
<&&+ ,
string&&, 2
>&&2 3
(&&3 4
type&&4 8
:&&8 9
$str&&: I
,&&I J
nullable&&K S
:&&S T
false&&U Z
)&&Z [
}'' 
,'' 
constraints(( 
:(( 
table(( "
=>((# %
{)) 
table** 
.** 

PrimaryKey** $
(**$ %
$str**% 0
,**0 1
x**2 3
=>**4 6
x**7 8
.**8 9
Id**9 ;
)**; <
;**< =
}++ 
)++ 
;++ 
migrationBuilder-- 
.-- 
CreateTable-- (
(--( )
name.. 
:.. 
$str.. 
,.. 
columns// 
:// 
table// 
=>// !
new//" %
{00 
Id11 
=11 
table11 
.11 
Column11 %
<11% &
int11& )
>11) *
(11* +
type11+ /
:11/ 0
$str111 6
,116 7
nullable118 @
:11@ A
false11B G
)11G H
.22 

Annotation22 #
(22# $
$str22$ 8
,228 9
$str22: @
)22@ A
,22A B
Title33 
=33 
table33 !
.33! "
Column33" (
<33( )
string33) /
>33/ 0
(330 1
type331 5
:335 6
$str337 F
,33F G
nullable33H P
:33P Q
false33R W
)33W X
,33X Y
AuthorId44 
=44 
table44 $
.44$ %
Column44% +
<44+ ,
int44, /
>44/ 0
(440 1
type441 5
:445 6
$str447 <
,44< =
nullable44> F
:44F G
false44H M
)44M N
,44N O
PublishDate55 
=55  !
table55" '
.55' (
Column55( .
<55. /
DateTime55/ 7
>557 8
(558 9
type559 =
:55= >
$str55? J
,55J K
nullable55L T
:55T U
false55V [
)55[ \
,55\ ]
Genre66 
=66 
table66 !
.66! "
Column66" (
<66( )
string66) /
>66/ 0
(660 1
type661 5
:665 6
$str667 F
,66F G
nullable66H P
:66P Q
false66R W
)66W X
,66X Y
	Available77 
=77 
table77  %
.77% &
Column77& ,
<77, -
bool77- 1
>771 2
(772 3
type773 7
:777 8
$str779 >
,77> ?
nullable77@ H
:77H I
false77J O
)77O P
}88 
,88 
constraints99 
:99 
table99 "
=>99# %
{:: 
table;; 
.;; 

PrimaryKey;; $
(;;$ %
$str;;% .
,;;. /
x;;0 1
=>;;2 4
x;;5 6
.;;6 7
Id;;7 9
);;9 :
;;;: ;
table<< 
.<< 

ForeignKey<< $
(<<$ %
name== 
:== 
$str== 7
,==7 8
column>> 
:>> 
x>>  !
=>>>" $
x>>% &
.>>& '
AuthorId>>' /
,>>/ 0
principalTable?? &
:??& '
$str??( 0
,??0 1
principalColumn@@ '
:@@' (
$str@@) -
,@@- .
onDeleteAA  
:AA  !
ReferentialActionAA" 3
.AA3 4
CascadeAA4 ;
)AA; <
;AA< =
}BB 
)BB 
;BB 
migrationBuilderDD 
.DD 
CreateIndexDD (
(DD( )
nameEE 
:EE 
$strEE (
,EE( )
tableFF 
:FF 
$strFF 
,FF 
columnGG 
:GG 
$strGG "
)GG" #
;GG# $
}HH 	
	protectedKK 
overrideKK 
voidKK 
DownKK  $
(KK$ %
MigrationBuilderKK% 5
migrationBuilderKK6 F
)KKF G
{LL 	
migrationBuilderMM 
.MM 
	DropTableMM &
(MM& '
nameNN 
:NN 
$strNN 
)NN 
;NN 
migrationBuilderPP 
.PP 
	DropTablePP &
(PP& '
nameQQ 
:QQ 
$strQQ 
)QQ 
;QQ 
migrationBuilderSS 
.SS 
	DropTableSS &
(SS& '
nameTT 
:TT 
$strTT 
)TT 
;TT  
}UU 	
}VV 
}WW ¥
‡C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Filter\AuthFilter.cs
	namespace 	
FullMetalLibrary
 
. 
Filter !
{ 
public 

class 

AuthFilter 
: !
ActionFilterAttribute 2
{ 
public 
override 
void 
OnActionExecuting .
(. /"
ActionExecutingContext/ E
contextF M
)M N
{		 	
var

 
httpContext

 
=

 
context

 %
.

% &
HttpContext

& 1
;

1 2
var 
user 
= 
httpContext "
." #
Session# *
.* +
	GetString+ 4
(4 5
$str5 @
)@ A
;A B
var 
controllerName 
=  
context! (
.( )
	RouteData) 2
.2 3
Values3 9
[9 :
$str: F
]F G
?G H
.H I
ToStringI Q
(Q R
)R S
;S T
if 
( 
controllerName 
? 
.  
Equals  &
(& '
$str' -
,- .
StringComparison/ ?
.? @
OrdinalIgnoreCase@ Q
)Q R
==S U
trueV Z
)Z [
{ 
base 
. 
OnActionExecuting &
(& '
context' .
). /
;/ 0
return 
; 
} 
if 
( 
string 
. 
IsNullOrEmpty $
($ %
user% )
)) *
)* +
{ 
context 
. 
Result 
=  
new! $"
RedirectToActionResult% ;
(; <
$str< C
,C D
$strE M
,M N
nullO S
)S T
;T U
return 
; 
} 
base 
. 
OnActionExecuting "
(" #
context# *
)* +
;+ ,
} 	
}   
}!! Ã
’C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Data\FullMetalLibraryContext.cs
	namespace 	
FullMetalLibrary
 
. 
Data 
{		 
public

 

class

 #
FullMetalLibraryContext

 (
:

) *
	DbContext

+ 4
{ 
public #
FullMetalLibraryContext &
(& '
DbContextOptions' 7
<7 8#
FullMetalLibraryContext8 O
>O P
optionsQ X
)X Y
: 
base 
( 
options 
) 
{ 
} 
public 
DbSet 
< 
Author 
> 
Author #
{$ %
get& )
;) *
set+ .
;. /
}0 1
=2 3
default4 ;
!; <
;< =
public 
DbSet 
< 
Book 
> 
Book 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
default0 7
!7 8
;8 9
public 
DbSet 
< 
FullMetalLibrary %
.% &
Models& ,
., -
Admin- 2
>2 3
Admin4 9
{: ;
get< ?
;? @
setA D
;D E
}F G
=H I
defaultJ Q
!Q R
;R S
} 
} ²
C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Controllers\HomeController.cs
	namespace 	
FullMetalLibrary
 
. 
Controllers &
{ 
public 

class 
HomeController 
:  !

Controller" ,
{ 
private		 
readonly		 
ILogger		  
<		  !
HomeController		! /
>		/ 0
_logger		1 8
;		8 9
public 
HomeController 
( 
ILogger %
<% &
HomeController& 4
>4 5
logger6 <
)< =
{ 	
_logger 
= 
logger 
; 
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
public 
IActionResult 
Privacy $
($ %
)% &
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
ResponseCache	 
( 
Duration 
=  !
$num" #
,# $
Location% -
=. /!
ResponseCacheLocation0 E
.E F
NoneF J
,J K
NoStoreL S
=T U
trueV Z
)Z [
][ \
public 
IActionResult 
Error "
(" #
)# $
{ 	
return 
View 
( 
new 
ErrorViewModel *
{+ ,
	RequestId- 6
=7 8
Activity9 A
.A B
CurrentB I
?I J
.J K
IdK M
??N P
HttpContextQ \
.\ ]
TraceIdentifier] l
}m n
)n o
;o p
} 	
} 
}   ×¢
‘C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Controllers\BooksController.cs
	namespace 	
FullMetalLibrary
 
. 
Controllers &
{ 
[ 

AuthFilter 
] 
public 

class 
BooksController  
(  !#
FullMetalLibraryContext! 8
context9 @
)@ A
:B C

ControllerD N
{ 
private 
readonly #
FullMetalLibraryContext 0
_context1 9
=: ;
context< C
;C D
public 
IActionResult 
Login "
(" #
)# $
{ 	
return 
View 
( 
new 
LoginViewModel *
(* +
)+ ,
), -
;- .
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
string/ 5
	sortOrder6 ?
,? @
stringA G
searchStringH T
)T U
{ 	
ViewData 
[ 
$str $
]$ %
=& '
string( .
.. /
IsNullOrEmpty/ <
(< =
	sortOrder= F
)F G
?H I
$strJ V
:W X
$strY [
;[ \
ViewData 
[ 
$str %
]% &
=' (
	sortOrder) 2
==3 5
$str6 A
?B C
$strD O
:P Q
$strR ]
;] ^
ViewData   
[   
$str   #
]  # $
=  % &
	sortOrder  ' 0
==  1 3
$str  4 >
?  ? @
$str  A L
:  M N
$str  O U
;  U V
ViewData!! 
[!! 
$str!! $
]!!$ %
=!!& '
searchString!!( 4
;!!4 5
var## 
books## 
=## 
_context##  
.##  !
Book##! %
.##% &
Include##& -
(##- .
b##. /
=>##0 2
b##3 4
.##4 5
Author##5 ;
)##; <
.##< =
AsQueryable##= H
(##H I
)##I J
;##J K
if&& 
(&& 
!&& 
string&& 
.&& 
IsNullOrEmpty&& %
(&&% &
searchString&&& 2
)&&2 3
)&&3 4
{'' 
bool)) 
	bookMatch)) 
=))  
books))! &
.))& '
Any))' *
())* +
b))+ ,
=>))- /
(** 
b** 
.** 
Title** 
!=** 
null**  $
&&**% '
b**( )
.**) *
Title*** /
.**/ 0
Contains**0 8
(**8 9
searchString**9 E
)**E F
)**F G
||**H J
(++ 
b++ 
.++ 
Genre++ 
!=++ 
null++  $
&&++% '
b++( )
.++) *
Genre++* /
.++/ 0
Contains++0 8
(++8 9
searchString++9 E
)++E F
)++F G
||++H J
(,, 
b,, 
.,, 
Author,, 
!=,,  
null,,! %
&&,,& (
b,,) *
.,,* +
Author,,+ 1
.,,1 2
	FirstName,,2 ;
!=,,< >
null,,? C
&&,,D F
b,,G H
.,,H I
Author,,I O
.,,O P
	FirstName,,P Y
.,,Y Z
Contains,,Z b
(,,b c
searchString,,c o
),,o p
),,p q
||,,r t
(-- 
b-- 
.-- 
Author-- 
!=--  
null--! %
&&--& (
b--) *
.--* +
Author--+ 1
.--1 2
LastName--2 :
!=--; =
null--> B
&&--C E
b--F G
.--G H
Author--H N
.--N O
LastName--O W
.--W X
Contains--X `
(--` a
searchString--a m
)--m n
)--n o
)--o p
;--p q
bool00 

adminMatch00 
=00  !
_context00" *
.00* +
Admin00+ 0
.000 1
Any001 4
(004 5
a005 6
=>007 9
(11 
a11 
.11 
UserName11 
!=11  "
null11# '
&&11( *
a11+ ,
.11, -
UserName11- 5
.115 6
Contains116 >
(11> ?
searchString11? K
)11K L
)11L M
||11N P
(22 
a22 
.22 
EmailAddress22 #
!=22$ &
null22' +
&&22, .
a22/ 0
.220 1
EmailAddress221 =
.22= >
Contains22> F
(22F G
searchString22G S
)22S T
)22T U
)22U V
;22V W
if44 
(44 
	bookMatch44 
)44 
{55 
books66 
=66 
books66 !
.66! "
Where66" '
(66' (
b66( )
=>66* ,
(77 
b77 
.77 
Title77  
!=77! #
null77$ (
&&77) +
b77, -
.77- .
Title77. 3
.773 4
Contains774 <
(77< =
searchString77= I
)77I J
)77J K
||77L N
(88 
b88 
.88 
Genre88  
!=88! #
null88$ (
&&88) +
b88, -
.88- .
Genre88. 3
.883 4
Contains884 <
(88< =
searchString88= I
)88I J
)88J K
||88L N
(99 
b99 
.99 
Author99 !
!=99" $
null99% )
&&99* ,
b99- .
.99. /
Author99/ 5
.995 6
	FirstName996 ?
!=99@ B
null99C G
&&99H J
b99K L
.99L M
Author99M S
.99S T
	FirstName99T ]
.99] ^
Contains99^ f
(99f g
searchString99g s
)99s t
)99t u
||99v x
(:: 
b:: 
.:: 
Author:: !
!=::" $
null::% )
&&::* ,
b::- .
.::. /
Author::/ 5
.::5 6
LastName::6 >
!=::? A
null::B F
&&::G I
b::J K
.::K L
Author::L R
.::R S
LastName::S [
.::[ \
Contains::\ d
(::d e
searchString::e q
)::q r
)::r s
)::s t
;::t u
};; 
else<< 
if<< 
(<< 

adminMatch<< #
)<<# $
{== 
ViewBag?? 
.?? 
AdminMatched?? (
=??) *
true??+ /
;??/ 0
}@@ 
elseAA 
{BB 
ViewBagDD 
.DD 
NotFoundMessageDD +
=DD, -
$"DD. 0
$strDD0 F
{DDF G
searchStringDDG S
}DDS T
$strDDT j
"DDj k
;DDk l
returnEE 
ViewEE 
(EE  
newEE  #
ListEE$ (
<EE( )
BookEE) -
>EE- .
(EE. /
)EE/ 0
)EE0 1
;EE1 2
}FF 
}GG 
booksJJ 
=JJ 
	sortOrderJJ 
switchJJ $
{KK 
$strLL 
=>LL 
booksLL 
.MM 
OrderByMM  
(MM  !
bMM! "
=>MM# %
bMM& '
.MM' (
TitleMM( -
)MM- .
.NN 
ThenByNN 
(NN  
bNN  !
=>NN" $
bNN% &
.NN& '
AuthorNN' -
!=NN. 0
nullNN1 5
?NN6 7
bNN8 9
.NN9 :
AuthorNN: @
.NN@ A
LastNameNNA I
:NNJ K
$strNNL N
)NNN O
.OO 
ThenByOO 
(OO  
bOO  !
=>OO" $
bOO% &
.OO& '
AuthorOO' -
!=OO. 0
nullOO1 5
?OO6 7
bOO8 9
.OO9 :
AuthorOO: @
.OO@ A
	FirstNameOOA J
:OOK L
$strOOM O
)OOO P
,OOP Q
$strPP 
=>PP 
booksPP 
.QQ 
OrderByDescendingQQ *
(QQ* +
bQQ+ ,
=>QQ- /
bQQ0 1
.QQ1 2
TitleQQ2 7
)QQ7 8
.RR 
ThenByDescendingRR )
(RR) *
bRR* +
=>RR, .
bRR/ 0
.RR0 1
AuthorRR1 7
!=RR8 :
nullRR; ?
?RR@ A
bRRB C
.RRC D
AuthorRRD J
.RRJ K
LastNameRRK S
:RRT U
$strRRV X
)RRX Y
.SS 
ThenByDescendingSS )
(SS) *
bSS* +
=>SS, .
bSS/ 0
.SS0 1
AuthorSS1 7
!=SS8 :
nullSS; ?
?SS@ A
bSSB C
.SSC D
AuthorSSD J
.SSJ K
	FirstNameSSK T
:SSU V
$strSSW Y
)SSY Z
,SSZ [
_TT 
=>TT 
booksTT 
.TT 
OrderByTT "
(TT" #
bTT# $
=>TT% '
bTT( )
.TT) *
TitleTT* /
)TT/ 0
}UU 
;UU 
returnWW 
ViewWW 
(WW 
awaitWW 
booksWW #
.WW# $
ToListAsyncWW$ /
(WW/ 0
)WW0 1
)WW1 2
;WW2 3
}XX 	
public[[ 
async[[ 
Task[[ 
<[[ 
IActionResult[[ '
>[[' (
Details[[) 0
([[0 1
int[[1 4
?[[4 5
id[[6 8
)[[8 9
{\\ 	
if]] 
(]] 
id]] 
==]] 
null]] 
)]] 
return]] "
NotFound]]# +
(]]+ ,
)]], -
;]]- .
var__ 
book__ 
=__ 
await__ 
_context__ %
.__% &
Book__& *
.`` 
Include`` 
(`` 
b`` 
=>`` 
b`` 
.``  
Author``  &
)``& '
.aa 
FirstOrDefaultAsyncaa $
(aa$ %
maa% &
=>aa' )
maa* +
.aa+ ,
Idaa, .
==aa/ 1
idaa2 4
)aa4 5
;aa5 6
ifcc 
(cc 
bookcc 
==cc 
nullcc 
)cc 
returncc $
NotFoundcc% -
(cc- .
)cc. /
;cc/ 0
returnee 
Viewee 
(ee 
bookee 
)ee 
;ee 
}ff 	
publicii 
IActionResultii 
Createii #
(ii# $
)ii$ %
{jj 	&
PopulateAuthorDropDownListkk &
(kk& '
)kk' (
;kk( )
returnll 
Viewll 
(ll 
)ll 
;ll 
}mm 	
[pp 	
HttpPostpp	 
]pp 
[qq 	$
ValidateAntiForgeryTokenqq	 !
]qq! "
publicrr 
asyncrr 
Taskrr 
<rr 
IActionResultrr '
>rr' (
Createrr) /
(rr/ 0
[rr0 1
Bindrr1 5
(rr5 6
$strrr6 b
)rrb c
]rrc d
Bookrre i
bookrrj n
)rrn o
{ss 	
iftt 
(tt 
booktt 
.tt 
PublishDatett  
>=tt! #
DateTimett$ ,
.tt, -
Todaytt- 2
)tt2 3
{uu 

ModelStatevv 
.vv 
AddModelErrorvv (
(vv( )
$strvv) 6
,vv6 7
$strvv8 [
)vv[ \
;vv\ ]
}ww 
ifxx 
(xx 

ModelStatexx 
.xx 
IsValidxx "
)xx" #
{yy 
_contextzz 
.zz 
Addzz 
(zz 
bookzz !
)zz! "
;zz" #
await{{ 
_context{{ 
.{{ 
SaveChangesAsync{{ /
({{/ 0
){{0 1
;{{1 2
return|| 
RedirectToAction|| '
(||' (
nameof||( .
(||. /
Index||/ 4
)||4 5
)||5 6
;||6 7
}}} &
PopulateAuthorDropDownList~~ &
(~~& '
book~~' +
.~~+ ,
AuthorId~~, 4
)~~4 5
;~~5 6
return 
View 
( 
book 
) 
; 
}
€€ 	
public
ƒƒ 
async
ƒƒ 
Task
ƒƒ 
<
ƒƒ 
IActionResult
ƒƒ '
>
ƒƒ' (
Edit
ƒƒ) -
(
ƒƒ- .
int
ƒƒ. 1
?
ƒƒ1 2
id
ƒƒ3 5
)
ƒƒ5 6
{
„„ 	
if
…… 
(
…… 
id
…… 
==
…… 
null
…… 
)
…… 
return
…… "
NotFound
……# +
(
……+ ,
)
……, -
;
……- .
var
‡‡ 
book
‡‡ 
=
‡‡ 
await
‡‡ 
_context
‡‡ %
.
‡‡% &
Book
‡‡& *
.
‡‡* +
	FindAsync
‡‡+ 4
(
‡‡4 5
id
‡‡5 7
)
‡‡7 8
;
‡‡8 9
if
ˆˆ 
(
ˆˆ 
book
ˆˆ 
==
ˆˆ 
null
ˆˆ 
)
ˆˆ 
return
ˆˆ $
NotFound
ˆˆ% -
(
ˆˆ- .
)
ˆˆ. /
;
ˆˆ/ 0(
PopulateAuthorDropDownList
ŠŠ &
(
ŠŠ& '
book
ŠŠ' +
.
ŠŠ+ ,
AuthorId
ŠŠ, 4
)
ŠŠ4 5
;
ŠŠ5 6
return
‹‹ 
View
‹‹ 
(
‹‹ 
book
‹‹ 
)
‹‹ 
;
‹‹ 
}
ŒŒ 	
[
 	
HttpPost
	 
]
 
[
 	&
ValidateAntiForgeryToken
	 !
]
! "
public
‘‘ 
async
‘‘ 
Task
‘‘ 
<
‘‘ 
IActionResult
‘‘ '
>
‘‘' (
Edit
‘‘) -
(
‘‘- .
int
‘‘. 1
id
‘‘2 4
,
‘‘4 5
[
‘‘6 7
Bind
‘‘7 ;
(
‘‘; <
$str
‘‘< k
)
‘‘k l
]
‘‘l m
Book
‘‘n r
book
‘‘s w
)
‘‘w x
{
’’ 	
if
““ 
(
““ 
id
““ 
!=
““ 
book
““ 
.
““ 
Id
““ 
)
““ 
return
““ %
NotFound
““& .
(
““. /
)
““/ 0
;
““0 1
if
”” 
(
”” 
book
”” 
.
”” 
PublishDate
””  
>=
””! #
DateTime
””$ ,
.
””, -
Today
””- 2
)
””2 3
{
•• 

ModelState
–– 
.
–– 
AddModelError
–– (
(
––( )
$str
––) 6
,
––6 7
$str
––8 [
)
––[ \
;
––\ ]
}
—— 
if
˜˜ 
(
˜˜ 

ModelState
˜˜ 
.
˜˜ 
IsValid
˜˜ "
)
˜˜" #
{
™™ 
_context
šš 
.
šš 
Update
šš 
(
šš  
book
šš  $
)
šš$ %
;
šš% &
await
›› 
_context
›› 
.
›› 
SaveChangesAsync
›› /
(
››/ 0
)
››0 1
;
››1 2
return
œœ 
RedirectToAction
œœ '
(
œœ' (
nameof
œœ( .
(
œœ. /
Index
œœ/ 4
)
œœ4 5
)
œœ5 6
;
œœ6 7
}
 (
PopulateAuthorDropDownList
žž &
(
žž& '
book
žž' +
.
žž+ ,
AuthorId
žž, 4
)
žž4 5
;
žž5 6
return
ŸŸ 
View
ŸŸ 
(
ŸŸ 
book
ŸŸ 
)
ŸŸ 
;
ŸŸ 
}
   	
public
¤¤ 
async
¤¤ 
Task
¤¤ 
<
¤¤ 
IActionResult
¤¤ '
>
¤¤' (
Delete
¤¤) /
(
¤¤/ 0
int
¤¤0 3
?
¤¤3 4
id
¤¤5 7
)
¤¤7 8
{
¥¥ 	
if
¦¦ 
(
¦¦ 
id
¦¦ 
==
¦¦ 
null
¦¦ 
)
¦¦ 
return
¦¦ "
NotFound
¦¦# +
(
¦¦+ ,
)
¦¦, -
;
¦¦- .
var
©© 
bookToDelete
©© 
=
©© 
await
©© $
_context
©©% -
.
©©- .
Book
©©. 2
.
©©2 3
	FindAsync
©©3 <
(
©©< =
id
©©= ?
)
©©? @
;
©©@ A
if
«« 
(
«« 
bookToDelete
«« 
==
«« 
null
««  $
)
««$ %
return
««& ,
NotFound
««- 5
(
««5 6
)
««6 7
;
««7 8
var
®® 
model
®® 
=
®® 
new
®® 
{
¯¯ 
bookToDelete
°° 
.
°° 
Id
°° 
,
°°  
bookToDelete
±± 
.
±± 
Title
±± "
,
±±" #

AuthorName
²² 
=
²² 
bookToDelete
²² )
.
²²) *
Author
²²* 0
?
²²0 1
.
²²1 2
	FirstName
²²2 ;
+
²²< =
$str
²²> A
+
²²B C
bookToDelete
²²D P
.
²²P Q
Author
²²Q W
?
²²W X
.
²²X Y
LastName
²²Y a
}
³³ 
;
³³ 
return
µµ 
View
µµ 
(
µµ 
model
µµ 
)
µµ 
;
µµ 
}
¶¶ 	
[
ºº 	
HttpPost
ºº	 
,
ºº 

ActionName
ºº 
(
ºº 
$str
ºº &
)
ºº& '
]
ºº' (
[
»» 	&
ValidateAntiForgeryToken
»»	 !
]
»»! "
public
¼¼ 
async
¼¼ 
Task
¼¼ 
<
¼¼ 
IActionResult
¼¼ '
>
¼¼' (
DeleteConfirmed
¼¼) 8
(
¼¼8 9
int
¼¼9 <
id
¼¼= ?
)
¼¼? @
{
½½ 	
var
¾¾ 
book
¾¾ 
=
¾¾ 
await
¾¾ 
_context
¾¾ %
.
¾¾% &
Book
¾¾& *
.
¾¾* +
	FindAsync
¾¾+ 4
(
¾¾4 5
id
¾¾5 7
)
¾¾7 8
;
¾¾8 9
if
¿¿ 
(
¿¿ 
book
¿¿ 
!=
¿¿ 
null
¿¿ 
)
¿¿ 
{
ÀÀ 
_context
ÁÁ 
.
ÁÁ 
Book
ÁÁ 
.
ÁÁ 
Remove
ÁÁ $
(
ÁÁ$ %
book
ÁÁ% )
)
ÁÁ) *
;
ÁÁ* +
await
ÂÂ 
_context
ÂÂ 
.
ÂÂ 
SaveChangesAsync
ÂÂ /
(
ÂÂ/ 0
)
ÂÂ0 1
;
ÂÂ1 2
}
ÃÃ 
return
ÄÄ 
RedirectToAction
ÄÄ #
(
ÄÄ# $
nameof
ÄÄ$ *
(
ÄÄ* +
Index
ÄÄ+ 0
)
ÄÄ0 1
)
ÄÄ1 2
;
ÄÄ2 3
}
ÅÅ 	
private
ÇÇ 
void
ÇÇ (
PopulateAuthorDropDownList
ÇÇ /
(
ÇÇ/ 0
object
ÇÇ0 6
?
ÇÇ6 7
selectedAuthor
ÇÇ8 F
=
ÇÇG H
null
ÇÇI M
)
ÇÇM N
{
ÈÈ 	
var
ÉÉ 
authors
ÉÉ 
=
ÉÉ 
_context
ÉÉ "
.
ÉÉ" #
Author
ÉÉ# )
.
ÊÊ 
OrderBy
ÊÊ 
(
ÊÊ 
a
ÊÊ 
=>
ÊÊ 
a
ÊÊ 
.
ÊÊ  
LastName
ÊÊ  (
)
ÊÊ( )
.
ËË 
ThenBy
ËË 
(
ËË 
a
ËË 
=>
ËË 
a
ËË 
.
ËË 
	FirstName
ËË (
)
ËË( )
.
ÌÌ 
Select
ÌÌ 
(
ÌÌ 
a
ÌÌ 
=>
ÌÌ 
new
ÌÌ  
{
ÌÌ! "
a
ÌÌ# $
.
ÌÌ$ %
Id
ÌÌ% '
,
ÌÌ' (
Name
ÌÌ) -
=
ÌÌ. /
a
ÌÌ0 1
.
ÌÌ1 2
	FirstName
ÌÌ2 ;
+
ÌÌ< =
$str
ÌÌ> A
+
ÌÌB C
a
ÌÌD E
.
ÌÌE F
LastName
ÌÌF N
}
ÌÌO P
)
ÌÌP Q
.
ÍÍ 
ToList
ÍÍ 
(
ÍÍ 
)
ÍÍ 
;
ÍÍ 
ViewBag
ÏÏ 
.
ÏÏ 

AuthorList
ÏÏ 
=
ÏÏ  
new
ÏÏ! $

SelectList
ÏÏ% /
(
ÏÏ/ 0
authors
ÏÏ0 7
,
ÏÏ7 8
$str
ÏÏ9 =
,
ÏÏ= >
$str
ÏÏ? E
,
ÏÏE F
selectedAuthor
ÏÏG U
)
ÏÏU V
;
ÏÏV W
}
ÐÐ 	
}
ÑÑ 
}ÒÒ Õ^
“C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Controllers\AuthorsController.cs
	namespace 	
FullMetalLibrary
 
. 
Controllers &
{ 
[ 

AuthFilter 
] 
public 

class 
AuthorsController "
:# $

Controller% /
{ 
private 
readonly #
FullMetalLibraryContext 0
_context1 9
;9 :
public 
AuthorsController  
(  !#
FullMetalLibraryContext! 8
context9 @
)@ A
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
string/ 5
	sortOrder6 ?
,? @
stringA G
searchStringH T
)T U
{ 	
ViewData 
[ 
$str $
]$ %
=& '
searchString( 4
;4 5
var   
authors   
=   
from   
a    
in  ! #
_context  $ ,
.  , -
Author  - 3
select!!  
a!!! "
;!!" #
if$$ 
($$ 
!$$ 
string$$ 
.$$ 
IsNullOrEmpty$$ %
($$% &
searchString$$& 2
)$$2 3
)$$3 4
{%% 
authors&& 
=&& 
authors&& !
.&&! "
Where&&" '
(&&' (
a&&( )
=>&&* ,
a'' 
.'' 
	FirstName'' 
.''  
Contains''  (
(''( )
searchString'') 5
)''5 6
||''7 9
a(( 
.(( 
LastName(( 
.(( 
Contains(( '
(((' (
searchString((( 4
)((4 5
)((5 6
;((6 7
})) 
authors,, 
=,, 
	sortOrder,, 
switch,,  &
{-- 
$str.. 
=>.. 
authors.. 
...  
OrderByDescending..  1
(..1 2
a..2 3
=>..4 6
a..7 8
...8 9
LastName..9 A
)..A B
...B C
ThenByDescending..C S
(..S T
a..T U
=>..V X
a..Y Z
...Z [
	FirstName..[ d
)..d e
,..e f
$str// 
=>// 
authors// 
.//  
OrderBy//  '
(//' (
a//( )
=>//* ,
a//- .
.//. /
LastName/// 7
)//7 8
.//8 9
ThenBy//9 ?
(//? @
a//@ A
=>//B D
a//E F
.//F G
	FirstName//G P
)//P Q
,//Q R
_00 
=>00 
authors00 
.00 
OrderBy00 $
(00$ %
a00% &
=>00' )
a00* +
.00+ ,
LastName00, 4
)004 5
.005 6
ThenBy006 <
(00< =
a00= >
=>00? A
a00B C
.00C D
	FirstName00D M
)00M N
}11 
;11 
return33 
View33 
(33 
await33 
authors33 %
.33% &
ToListAsync33& 1
(331 2
)332 3
)333 4
;334 5
}44 	
public88 
async88 
Task88 
<88 
IActionResult88 '
>88' (
Details88) 0
(880 1
int881 4
?884 5
id886 8
)888 9
{99 	
if:: 
(:: 
id:: 
==:: 
null:: 
):: 
{;; 
return<< 
NotFound<< 
(<<  
)<<  !
;<<! "
}== 
var?? 
author?? 
=?? 
await?? 
_context?? '
.??' (
Author??( .
.@@ 
FirstOrDefaultAsync@@ $
(@@$ %
m@@% &
=>@@' )
m@@* +
.@@+ ,
Id@@, .
==@@/ 1
id@@2 4
)@@4 5
;@@5 6
ifAA 
(AA 
authorAA 
==AA 
nullAA 
)AA 
{BB 
returnCC 
NotFoundCC 
(CC  
)CC  !
;CC! "
}DD 
returnFF 
ViewFF 
(FF 
authorFF 
)FF 
;FF  
}GG 	
publicJJ 
IActionResultJJ 
CreateJJ #
(JJ# $
)JJ$ %
{KK 	
returnLL 
ViewLL 
(LL 
)LL 
;LL 
}MM 	
[RR 	
HttpPostRR	 
]RR 
[SS 	$
ValidateAntiForgeryTokenSS	 !
]SS! "
publicTT 
asyncTT 
TaskTT 
<TT 
IActionResultTT '
>TT' (
CreateTT) /
(TT/ 0
[TT0 1
BindTT1 5
(TT5 6
$strTT6 M
)TTM N
]TTN O
AuthorTTP V
authorTTW ]
)TT] ^
{UU 	
ifVV 
(VV 

ModelStateVV 
.VV 
IsValidVV "
)VV" #
{WW 
_contextXX 
.XX 
AddXX 
(XX 
authorXX #
)XX# $
;XX$ %
awaitYY 
_contextYY 
.YY 
SaveChangesAsyncYY /
(YY/ 0
)YY0 1
;YY1 2
returnZZ 
RedirectToActionZZ '
(ZZ' (
nameofZZ( .
(ZZ. /
IndexZZ/ 4
)ZZ4 5
)ZZ5 6
;ZZ6 7
}[[ 
return\\ 
View\\ 
(\\ 
author\\ 
)\\ 
;\\  
}]] 	
public`` 
async`` 
Task`` 
<`` 
IActionResult`` '
>``' (
Edit``) -
(``- .
int``. 1
?``1 2
id``3 5
)``5 6
{aa 	
ifbb 
(bb 
idbb 
==bb 
nullbb 
)bb 
{cc 
returndd 
NotFounddd 
(dd  
)dd  !
;dd! "
}ee 
vargg 
authorgg 
=gg 
awaitgg 
_contextgg '
.gg' (
Authorgg( .
.gg. /
	FindAsyncgg/ 8
(gg8 9
idgg9 ;
)gg; <
;gg< =
ifhh 
(hh 
authorhh 
==hh 
nullhh 
)hh 
{ii 
returnjj 
NotFoundjj 
(jj  
)jj  !
;jj! "
}kk 
returnll 
Viewll 
(ll 
authorll 
)ll 
;ll  
}mm 	
[rr 	
HttpPostrr	 
]rr 
[ss 	$
ValidateAntiForgeryTokenss	 !
]ss! "
publictt 
asynctt 
Tasktt 
<tt 
IActionResulttt '
>tt' (
Edittt) -
(tt- .
inttt. 1
idtt2 4
,tt4 5
[tt6 7
Bindtt7 ;
(tt; <
$strtt< S
)ttS T
]ttT U
AuthorttV \
authortt] c
)ttc d
{uu 	
ifvv 
(vv 
idvv 
!=vv 
authorvv 
.vv 
Idvv 
)vv  
{ww 
returnxx 
NotFoundxx 
(xx  
)xx  !
;xx! "
}yy 
if{{ 
({{ 

ModelState{{ 
.{{ 
IsValid{{ "
){{" #
{|| 
try}} 
{~~ 
_context 
. 
Update #
(# $
author$ *
)* +
;+ ,
await
€€ 
_context
€€ "
.
€€" #
SaveChangesAsync
€€# 3
(
€€3 4
)
€€4 5
;
€€5 6
}
 
catch
‚‚ 
(
‚‚ *
DbUpdateConcurrencyException
‚‚ 3
)
‚‚3 4
{
ƒƒ 
if
„„ 
(
„„ 
!
„„ 
AuthorExists
„„ %
(
„„% &
author
„„& ,
.
„„, -
Id
„„- /
)
„„/ 0
)
„„0 1
{
…… 
return
†† 
NotFound
†† '
(
††' (
)
††( )
;
††) *
}
‡‡ 
else
ˆˆ 
{
‰‰ 
throw
ŠŠ 
;
ŠŠ 
}
‹‹ 
}
ŒŒ 
return
 
RedirectToAction
 '
(
' (
nameof
( .
(
. /
Index
/ 4
)
4 5
)
5 6
;
6 7
}
ŽŽ 
return
 
View
 
(
 
author
 
)
 
;
  
}
 	
public
““ 
async
““ 
Task
““ 
<
““ 
IActionResult
““ '
>
““' (
Delete
““) /
(
““/ 0
int
““0 3
?
““3 4
id
““5 7
)
““7 8
{
”” 	
if
•• 
(
•• 
id
•• 
==
•• 
null
•• 
)
•• 
{
–– 
return
—— 
NotFound
—— 
(
——  
)
——  !
;
——! "
}
˜˜ 
var
šš 
author
šš 
=
šš 
await
šš 
_context
šš '
.
šš' (
Author
šš( .
.
›› !
FirstOrDefaultAsync
›› $
(
››$ %
m
››% &
=>
››' )
m
››* +
.
››+ ,
Id
››, .
==
››/ 1
id
››2 4
)
››4 5
;
››5 6
if
œœ 
(
œœ 
author
œœ 
==
œœ 
null
œœ 
)
œœ 
{
 
return
žž 
NotFound
žž 
(
žž  
)
žž  !
;
žž! "
}
ŸŸ 
return
¡¡ 
View
¡¡ 
(
¡¡ 
author
¡¡ 
)
¡¡ 
;
¡¡  
}
¢¢ 	
[
¥¥ 	
HttpPost
¥¥	 
,
¥¥ 

ActionName
¥¥ 
(
¥¥ 
$str
¥¥ &
)
¥¥& '
]
¥¥' (
[
¦¦ 	&
ValidateAntiForgeryToken
¦¦	 !
]
¦¦! "
public
§§ 
async
§§ 
Task
§§ 
<
§§ 
IActionResult
§§ '
>
§§' (
DeleteConfirmed
§§) 8
(
§§8 9
int
§§9 <
id
§§= ?
)
§§? @
{
¨¨ 	
var
©© 
author
©© 
=
©© 
await
©© 
_context
©© '
.
©©' (
Author
©©( .
.
©©. /
	FindAsync
©©/ 8
(
©©8 9
id
©©9 ;
)
©©; <
;
©©< =
if
ªª 
(
ªª 
author
ªª 
!=
ªª 
null
ªª 
)
ªª 
{
«« 
_context
¬¬ 
.
¬¬ 
Author
¬¬ 
.
¬¬  
Remove
¬¬  &
(
¬¬& '
author
¬¬' -
)
¬¬- .
;
¬¬. /
}
­­ 
await
¯¯ 
_context
¯¯ 
.
¯¯ 
SaveChangesAsync
¯¯ +
(
¯¯+ ,
)
¯¯, -
;
¯¯- .
return
°° 
RedirectToAction
°° #
(
°°# $
nameof
°°$ *
(
°°* +
Index
°°+ 0
)
°°0 1
)
°°1 2
;
°°2 3
}
±± 	
private
³³ 
bool
³³ 
AuthorExists
³³ !
(
³³! "
int
³³" %
id
³³& (
)
³³( )
{
´´ 	
return
µµ 
_context
µµ 
.
µµ 
Author
µµ "
.
µµ" #
Any
µµ# &
(
µµ& '
e
µµ' (
=>
µµ) +
e
µµ, -
.
µµ- .
Id
µµ. 0
==
µµ1 3
id
µµ4 6
)
µµ6 7
;
µµ7 8
}
¶¶ 	
}
·· 
}¸¸ ƒÁ
’C:\Users\Dave\OneDrive - Whitireia and WelTec\Documents\Testing and Secure Coding\GroupAssignment\FullMetalLibrary\Controllers\AdminsController.cs
	namespace 	
FullMetalLibrary
 
. 
Controllers &
{ 
public 

class 
AdminsController !
(! "#
FullMetalLibraryContext" 9
context: A
)A B
:C D

ControllerE O
{ 
private 
readonly #
FullMetalLibraryContext 0
_context1 9
=: ;
context< C
;C D
[ 	

AuthFilter	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
string/ 5
	sortOrder6 ?
,? @
stringA G
searchStringH T
)T U
{ 	
ViewData 
[ 
$str $
]$ %
=& '
searchString( 4
;4 5
ViewData 
[ 
$str #
]# $
=% &
string' -
.- .
IsNullOrEmpty. ;
(; <
	sortOrder< E
)E F
?G H
$strI M
:N O
$strP R
;R S
var 
admins 
= 
from 
a 
in  "
_context# +
.+ ,
Admin, 1
select2 8
a9 :
;: ;
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
searchString& 2
)2 3
)3 4
{ 
admins   
=   
admins   
.    
Where    %
(  % &
a  & '
=>  ( *
a  + ,
.  , -
UserName  - 5
.  5 6
Contains  6 >
(  > ?
searchString  ? K
)  K L
||!!( *
a!!+ ,
.!!, -
EmailAddress!!- 9
.!!9 :
Contains!!: B
(!!B C
searchString!!C O
)!!O P
)!!P Q
;!!Q R
}"" 
admins%% 
=%% 
	sortOrder%% 
switch%% %
{&& 
$str'' 
=>'' 
admins'' 
.'' 
OrderBy'' &
(''& '
a''' (
=>'') +
a'', -
.''- .
UserName''. 6
)''6 7
,''7 8
$str(( 
=>(( 
admins(( 
.(( 
OrderByDescending(( 0
(((0 1
a((1 2
=>((3 5
a((6 7
.((7 8
UserName((8 @
)((@ A
,((A B
_)) 
=>)) 
admins)) 
.)) 
OrderBy)) #
())# $
a))$ %
=>))& (
a))) *
.))* +
UserName))+ 3
)))3 4
}** 
;** 
var,, 
list,, 
=,, 
await,, 
admins,, #
.,,# $
ToListAsync,,$ /
(,,/ 0
),,0 1
;,,1 2
return-- 
View-- 
(-- 
list-- 
)-- 
;-- 
}.. 	
public11 
IActionResult11 
Login11 "
(11" #
)11# $
{22 	
if33 
(33 
HttpContext33 
.33 
Session33 #
.33# $
	GetString33$ -
(33- .
$str33. 9
)339 :
!=33; =
null33> B
)33B C
{44 
return55 
RedirectToAction55 '
(55' (
$str55( /
,55/ 0
$str551 7
)557 8
;558 9
}66 
return77 
View77 
(77 
new77 
LoginViewModel77 *
(77* +
)77+ ,
)77, -
;77- .
}88 	
[:: 	
HttpPost::	 
]:: 
[;; 	$
ValidateAntiForgeryToken;;	 !
];;! "
public<< 
async<< 
Task<< 
<<< 
IActionResult<< '
><<' (
Login<<) .
(<<. /
LoginViewModel<</ =
model<<> C
)<<C D
{== 	
if>> 
(>> 
!>> 

ModelState>> 
.>> 
IsValid>> #
)>># $
return?? 
View?? 
(?? 
model?? !
)??! "
;??" #
varBB 
adminBB 
=BB 
awaitBB 
_contextBB &
.BB& '
AdminBB' ,
.BB, -
FirstOrDefaultAsyncBB- @
(BB@ A
aBBA B
=>BBC E
aBBF G
.BBG H
EmailAddressBBH T
==BBU W
modelBBX ]
.BB] ^
EmailBB^ c
)BBc d
;BBd e
ifCC 
(CC 
adminCC 
==CC 
nullCC 
)CC 
{DD 

ModelStateEE 
.EE 
AddModelErrorEE (
(EE( )
$strEE) 0
,EE0 1
$strEE2 N
)EEN O
;EEO P
returnFF 
ViewFF 
(FF 
modelFF !
)FF! "
;FF" #
}GG 
boolJJ 
passwordValidJJ 
=JJ  
PasswordHelperJJ! /
.JJ/ 0
VerifyPasswordJJ0 >
(JJ> ?
modelJJ? D
.JJD E
PasswordJJE M
,JJM N
adminJJO T
.JJT U
PasswordHashJJU a
)JJa b
;JJb c
ifLL 
(LL 
!LL 
passwordValidLL 
)LL 
{MM 

ModelStateNN 
.NN 
AddModelErrorNN (
(NN( )
$strNN) 0
,NN0 1
$strNN2 N
)NNN O
;NNO P
returnOO 
ViewOO 
(OO 
modelOO !
)OO! "
;OO" #
}PP 
ifSS 
(SS 
!SS 
adminSS 
.SS 
IsActiveSS 
)SS  
{TT 

ModelStateUU 
.UU 
AddModelErrorUU (
(UU( )
$strUU) 0
,UU0 1
$strUU2 Q
)UUQ R
;UUR S
returnVV 
ViewVV 
(VV 
modelVV !
)VV! "
;VV" #
}WW 
HttpContextZZ 
.ZZ 
SessionZZ 
.ZZ  
	SetStringZZ  )
(ZZ) *
$strZZ* 5
,ZZ5 6
adminZZ7 <
.ZZ< =
UserNameZZ= E
)ZZE F
;ZZF G
return[[ 
RedirectToAction[[ #
([[# $
$str[[$ +
,[[+ ,
$str[[- 3
)[[3 4
;[[4 5
}\\ 	
public^^ 
IActionResult^^ 
Logout^^ #
(^^# $
)^^$ %
{__ 	
HttpContext`` 
.`` 
Session`` 
.``  
Clear``  %
(``% &
)``& '
;``' (
returnaa 
RedirectToActionaa #
(aa# $
$straa$ +
)aa+ ,
;aa, -
}bb 	
[ee 	
HttpGetee	 
]ee 
publicff 
IActionResultff 
Registerff %
(ff% &
)ff& '
{gg 	
returnhh 
Viewhh 
(hh 
newhh 
RegisterViewModelhh -
(hh- .
)hh. /
)hh/ 0
;hh0 1
}ii 	
[kk 	
HttpPostkk	 
]kk 
[ll 	$
ValidateAntiForgeryTokenll	 !
]ll! "
publicmm 
asyncmm 
Taskmm 
<mm 
IActionResultmm '
>mm' (
Registermm) 1
(mm1 2
[mm2 3
Bindmm3 7
(mm7 8
$strmm8 a
)mma b
]mmb c
RegisterViewModelmmd u
modelmmv {
)mm{ |
{nn 	
ifoo 
(oo 
!oo 

ModelStateoo 
.oo 
IsValidoo #
)oo# $
returnoo% +
Viewoo, 0
(oo0 1
modeloo1 6
)oo6 7
;oo7 8
ifqq 
(qq 
awaitqq 
_contextqq 
.qq 
Adminqq $
.qq$ %
AnyAsyncqq% -
(qq- .
aqq. /
=>qq0 2
aqq3 4
.qq4 5
EmailAddressqq5 A
==qqB D
modelqqE J
.qqJ K
EmailqqK P
)qqP Q
)qqQ R
{rr 

ModelStatess 
.ss 
AddModelErrorss (
(ss( )
$strss) 0
,ss0 1
$strss2 Q
)ssQ R
;ssR S
returntt 
Viewtt 
(tt 
modeltt !
)tt! "
;tt" #
}uu 
ifww 
(ww 
!ww 
IsStrongPasswordww !
(ww! "
modelww" '
.ww' (
Passwordww( 0
)ww0 1
)ww1 2
{xx 

ModelStateyy 
.yy 
AddModelErroryy (
(yy( )
$stryy) 3
,yy3 4
$strzz u
)zzu v
;zzv w
return{{ 
View{{ 
({{ 
model{{ !
){{! "
;{{" #
}|| 
var~~ 
admin~~ 
=~~ 
new~~ 
Admin~~ !
{ 
UserName
€€ 
=
€€ 
model
€€  
.
€€  !
UserName
€€! )
,
€€) *
EmailAddress
 
=
 
model
 $
.
$ %
Email
% *
,
* +
	CreatedAt
‚‚ 
=
‚‚ 
DateTime
‚‚ $
.
‚‚$ %
Now
‚‚% (
,
‚‚( )
IsActive
ƒƒ 
=
ƒƒ 
true
ƒƒ 
,
ƒƒ  
PasswordHash
„„ 
=
„„ 
PasswordHelper
„„ -
.
„„- .
HashPassword
„„. :
(
„„: ;
model
„„; @
.
„„@ A
Password
„„A I
)
„„I J
}
…… 
;
…… 
_context
‡‡ 
.
‡‡ 
Add
‡‡ 
(
‡‡ 
admin
‡‡ 
)
‡‡ 
;
‡‡  
await
ˆˆ 
_context
ˆˆ 
.
ˆˆ 
SaveChangesAsync
ˆˆ +
(
ˆˆ+ ,
)
ˆˆ, -
;
ˆˆ- .
HttpContext
ŠŠ 
.
ŠŠ 
Session
ŠŠ 
.
ŠŠ  
	SetString
ŠŠ  )
(
ŠŠ) *
$str
ŠŠ* 5
,
ŠŠ5 6
admin
ŠŠ7 <
.
ŠŠ< =
UserName
ŠŠ= E
)
ŠŠE F
;
ŠŠF G
return
‹‹ 
RedirectToAction
‹‹ #
(
‹‹# $
$str
‹‹$ +
,
‹‹+ ,
$str
‹‹- 3
)
‹‹3 4
;
‹‹4 5
}
ŒŒ 	
public
 
async
 
Task
 
<
 
IActionResult
 '
>
' (
Details
) 0
(
0 1
int
1 4
?
4 5
id
6 8
)
8 9
{
 	
if
‘‘ 
(
‘‘ 
id
‘‘ 
==
‘‘ 
null
‘‘ 
)
‘‘ 
return
‘‘ "
NotFound
‘‘# +
(
‘‘+ ,
)
‘‘, -
;
‘‘- .
var
““ 
admin
““ 
=
““ 
await
““ 
_context
““ &
.
““& '
Admin
““' ,
.
““, -!
FirstOrDefaultAsync
““- @
(
““@ A
m
““A B
=>
““C E
m
““F G
.
““G H
Id
““H J
==
““K M
id
““N P
)
““P Q
;
““Q R
if
”” 
(
”” 
admin
”” 
==
”” 
null
”” 
)
”” 
return
”” %
NotFound
””& .
(
””. /
)
””/ 0
;
””0 1
return
–– 
View
–– 
(
–– 
admin
–– 
)
–– 
;
–– 
}
—— 	
public
šš 
IActionResult
šš 
Create
šš #
(
šš# $
)
šš$ %
=>
šš& (
View
šš) -
(
šš- .
)
šš. /
;
šš/ 0
[
œœ 	
HttpPost
œœ	 
]
œœ 
[
 	&
ValidateAntiForgeryToken
	 !
]
! "
public
žž 
async
žž 
Task
žž 
<
žž 
IActionResult
žž '
>
žž' (
Create
žž) /
(
žž/ 0
[
žž0 1
Bind
žž1 5
(
žž5 6
$str
žž6 f
)
žžf g
]
žžg h
Admin
žži n
admin
žžo t
)
žžt u
{
ŸŸ 	
if
   
(
   
await
   
_context
   
.
   
Admin
   $
.
  $ %
AnyAsync
  % -
(
  - .
a
  . /
=>
  0 2
a
  3 4
.
  4 5
EmailAddress
  5 A
==
  B D
admin
  E J
.
  J K
EmailAddress
  K W
)
  W X
)
  X Y
{
¡¡ 

ModelState
¢¢ 
.
¢¢ 
AddModelError
¢¢ (
(
¢¢( )
$str
¢¢) 7
,
¢¢7 8
$str
¢¢9 X
)
¢¢X Y
;
¢¢Y Z
return
££ 
View
££ 
(
££ 
admin
££ !
)
££! "
;
££" #
}
¤¤ 
if
¦¦ 
(
¦¦ 
!
¦¦ 
IsStrongPassword
¦¦ !
(
¦¦! "
admin
¦¦" '
.
¦¦' (
PasswordHash
¦¦( 4
)
¦¦4 5
)
¦¦5 6
{
§§ 

ModelState
¨¨ 
.
¨¨ 
AddModelError
¨¨ (
(
¨¨( )
$str
¨¨) 7
,
¨¨7 8
$str
©© u
)
©©u v
;
©©v w
return
ªª 
View
ªª 
(
ªª 
admin
ªª !
)
ªª! "
;
ªª" #
}
«« 
if
­­ 
(
­­ 

ModelState
­­ 
.
­­ 
IsValid
­­ "
)
­­" #
{
®® 
admin
¯¯ 
.
¯¯ 
	CreatedAt
¯¯ 
=
¯¯  !
DateTime
¯¯" *
.
¯¯* +
Now
¯¯+ .
;
¯¯. /
admin
°° 
.
°° 
PasswordHash
°° "
=
°°# $
PasswordHelper
°°% 3
.
°°3 4
HashPassword
°°4 @
(
°°@ A
admin
°°A F
.
°°F G
PasswordHash
°°G S
)
°°S T
;
°°T U
_context
²² 
.
²² 
Add
²² 
(
²² 
admin
²² "
)
²²" #
;
²²# $
await
³³ 
_context
³³ 
.
³³ 
SaveChangesAsync
³³ /
(
³³/ 0
)
³³0 1
;
³³1 2
return
´´ 
RedirectToAction
´´ '
(
´´' (
nameof
´´( .
(
´´. /
Index
´´/ 4
)
´´4 5
)
´´5 6
;
´´6 7
}
µµ 
return
¶¶ 
View
¶¶ 
(
¶¶ 
admin
¶¶ 
)
¶¶ 
;
¶¶ 
}
·· 	
public
ºº 
async
ºº 
Task
ºº 
<
ºº 
IActionResult
ºº '
>
ºº' (
Edit
ºº) -
(
ºº- .
int
ºº. 1
?
ºº1 2
id
ºº3 5
)
ºº5 6
{
»» 	
if
¼¼ 
(
¼¼ 
id
¼¼ 
==
¼¼ 
null
¼¼ 
)
¼¼ 
return
¼¼ "
NotFound
¼¼# +
(
¼¼+ ,
)
¼¼, -
;
¼¼- .
var
¾¾ 
admin
¾¾ 
=
¾¾ 
await
¾¾ 
_context
¾¾ &
.
¾¾& '
Admin
¾¾' ,
.
¾¾, -
	FindAsync
¾¾- 6
(
¾¾6 7
id
¾¾7 9
)
¾¾9 :
;
¾¾: ;
if
¿¿ 
(
¿¿ 
admin
¿¿ 
==
¿¿ 
null
¿¿ 
)
¿¿ 
return
¿¿ %
NotFound
¿¿& .
(
¿¿. /
)
¿¿/ 0
;
¿¿0 1
return
ÁÁ 
View
ÁÁ 
(
ÁÁ 
admin
ÁÁ 
)
ÁÁ 
;
ÁÁ 
}
ÂÂ 	
[
ÄÄ 	
HttpPost
ÄÄ	 
]
ÄÄ 
[
ÅÅ 	&
ValidateAntiForgeryToken
ÅÅ	 !
]
ÅÅ! "
public
ÆÆ 
async
ÆÆ 
Task
ÆÆ 
<
ÆÆ 
IActionResult
ÆÆ '
>
ÆÆ' (
Edit
ÆÆ) -
(
ÆÆ- .
int
ÆÆ. 1
id
ÆÆ2 4
,
ÆÆ4 5
[
ÆÆ6 7
Bind
ÆÆ7 ;
(
ÆÆ; <
$str
ÆÆ< v
)
ÆÆv w
]
ÆÆw x
Admin
ÆÆy ~
adminÆÆ „
)ÆÆ„ …
{
ÇÇ 	
if
ÈÈ 
(
ÈÈ 
id
ÈÈ 
!=
ÈÈ 
admin
ÈÈ 
.
ÈÈ 
Id
ÈÈ 
)
ÈÈ 
return
ÈÈ  &
NotFound
ÈÈ' /
(
ÈÈ/ 0
)
ÈÈ0 1
;
ÈÈ1 2
if
ÊÊ 
(
ÊÊ 
!
ÊÊ 
string
ÊÊ 
.
ÊÊ 
IsNullOrEmpty
ÊÊ %
(
ÊÊ% &
admin
ÊÊ& +
.
ÊÊ+ ,
PasswordHash
ÊÊ, 8
)
ÊÊ8 9
&&
ÊÊ: <
!
ÊÊ= >
IsStrongPassword
ÊÊ> N
(
ÊÊN O
admin
ÊÊO T
.
ÊÊT U
PasswordHash
ÊÊU a
)
ÊÊa b
)
ÊÊb c
{
ËË 

ModelState
ÌÌ 
.
ÌÌ 
AddModelError
ÌÌ (
(
ÌÌ( )
$str
ÌÌ) 7
,
ÌÌ7 8
$str
ÍÍ u
)
ÍÍu v
;
ÍÍv w
return
ÎÎ 
View
ÎÎ 
(
ÎÎ 
admin
ÎÎ !
)
ÎÎ! "
;
ÎÎ" #
}
ÏÏ 
if
ÑÑ 
(
ÑÑ 

ModelState
ÑÑ 
.
ÑÑ 
IsValid
ÑÑ "
)
ÑÑ" #
{
ÒÒ 
try
ÓÓ 
{
ÔÔ 
if
ÕÕ 
(
ÕÕ 
!
ÕÕ 
string
ÕÕ 
.
ÕÕ  
IsNullOrEmpty
ÕÕ  -
(
ÕÕ- .
admin
ÕÕ. 3
.
ÕÕ3 4
PasswordHash
ÕÕ4 @
)
ÕÕ@ A
)
ÕÕA B
admin
ÖÖ 
.
ÖÖ 
PasswordHash
ÖÖ *
=
ÖÖ+ ,
PasswordHelper
ÖÖ- ;
.
ÖÖ; <
HashPassword
ÖÖ< H
(
ÖÖH I
admin
ÖÖI N
.
ÖÖN O
PasswordHash
ÖÖO [
)
ÖÖ[ \
;
ÖÖ\ ]
_context
ØØ 
.
ØØ 
Update
ØØ #
(
ØØ# $
admin
ØØ$ )
)
ØØ) *
;
ØØ* +
await
ÙÙ 
_context
ÙÙ "
.
ÙÙ" #
SaveChangesAsync
ÙÙ# 3
(
ÙÙ3 4
)
ÙÙ4 5
;
ÙÙ5 6
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ *
DbUpdateConcurrencyException
ÛÛ 3
)
ÛÛ3 4
{
ÜÜ 
if
ÝÝ 
(
ÝÝ 
!
ÝÝ 
AdminExists
ÝÝ $
(
ÝÝ$ %
admin
ÝÝ% *
.
ÝÝ* +
Id
ÝÝ+ -
)
ÝÝ- .
)
ÝÝ. /
return
ÝÝ0 6
NotFound
ÝÝ7 ?
(
ÝÝ? @
)
ÝÝ@ A
;
ÝÝA B
else
ÞÞ 
throw
ÞÞ 
;
ÞÞ 
}
ßß 
return
àà 
RedirectToAction
àà '
(
àà' (
nameof
àà( .
(
àà. /
Index
àà/ 4
)
àà4 5
)
àà5 6
;
àà6 7
}
áá 
return
ââ 
View
ââ 
(
ââ 
admin
ââ 
)
ââ 
;
ââ 
}
ãã 	
publicçç 
async
çç 
Task
çç 
<
çç 
IActionResult
çç 
>
çç  
Delete
çç! '
(
çç' (
int
çç( +
?
çç+ ,
id
çç- /
)
çç/ 0
{èè 
if
éé 
(
éé 
id
éé 

==
éé 
null
éé 
)
éé 
return
éé 
NotFound
éé #
(
éé# $
)
éé$ %
;
éé% &
var
ìì 
adminToDelete
ìì 
=
ìì 
await
ìì 
_context
ìì &
.
ìì& '
Admin
ìì' ,
.
ìì, -
	FindAsync
ìì- 6
(
ìì6 7
id
ìì7 9
)
ìì9 :
;
ìì: ;
if
îî 
(
îî 
adminToDelete
îî 
==
îî 
null
îî 
)
îî 
return
îî %
NotFound
îî& .
(
îî. /
)
îî/ 0
;
îî0 1
var
ññ 
model
ññ 
=
ññ 
new
ññ 
Admin
ññ 
{
òò 
Id
óó 

=
óó 
adminToDelete
óó 
.
óó 
Id
óó 
,
óó 
UserName
ôô 
=
ôô 
adminToDelete
ôô  
.
ôô  !
UserName
ôô! )
,
ôô) *
EmailAddress
õõ 
=
õõ 
adminToDelete
õõ $
.
õõ$ %
EmailAddress
õõ% 1
}
öö 
;
öö 
return
øø 

View
øø 
(
øø 
model
øø 
)
øø 
;
øø 
}ùù 
[
üü 	
HttpPost
üü	 
,
üü 

ActionName
üü 
(
üü 
$str
üü &
)
üü& '
]
üü' (
[
ýý 	&
ValidateAntiForgeryToken
ýý	 !
]
ýý! "
public
þþ 
async
þþ 
Task
þþ 
<
þþ 
IActionResult
þþ '
>
þþ' (
DeleteConfirmed
þþ) 8
(
þþ8 9
int
þþ9 <
id
þþ= ?
)
þþ? @
{
ÿÿ 	
var
€€ 
admin
€€ 
=
€€ 
await
€€ 
_context
€€ &
.
€€& '
Admin
€€' ,
.
€€, -
	FindAsync
€€- 6
(
€€6 7
id
€€7 9
)
€€9 :
;
€€: ;
if
 
(
 
admin
 
!=
 
null
 
)
 
{
‚‚ 
_context
ƒƒ 
.
ƒƒ 
Admin
ƒƒ 
.
ƒƒ 
Remove
ƒƒ %
(
ƒƒ% &
admin
ƒƒ& +
)
ƒƒ+ ,
;
ƒƒ, -
await
„„ 
_context
„„ 
.
„„ 
SaveChangesAsync
„„ /
(
„„/ 0
)
„„0 1
;
„„1 2
}
…… 
return
†† 
RedirectToAction
†† #
(
††# $
nameof
††$ *
(
††* +
Index
††+ 0
)
††0 1
)
††1 2
;
††2 3
}
‡‡ 	
private
ŠŠ 
bool
ŠŠ 
AdminExists
ŠŠ  
(
ŠŠ  !
int
ŠŠ! $
id
ŠŠ% '
)
ŠŠ' (
=>
ŠŠ) +
_context
ŠŠ, 4
.
ŠŠ4 5
Admin
ŠŠ5 :
.
ŠŠ: ;
Any
ŠŠ; >
(
ŠŠ> ?
e
ŠŠ? @
=>
ŠŠA C
e
ŠŠD E
.
ŠŠE F
Id
ŠŠF H
==
ŠŠI K
id
ŠŠL N
)
ŠŠN O
;
ŠŠO P
public
ŒŒ 
static
ŒŒ 
bool
ŒŒ 
IsStrongPassword
ŒŒ +
(
ŒŒ+ ,
string
ŒŒ, 2
password
ŒŒ3 ;
)
ŒŒ; <
{
 	
if
ŽŽ 
(
ŽŽ 
string
ŽŽ 
.
ŽŽ 
IsNullOrEmpty
ŽŽ $
(
ŽŽ$ %
password
ŽŽ% -
)
ŽŽ- .
)
ŽŽ. /
return
ŽŽ0 6
false
ŽŽ7 <
;
ŽŽ< =
var
 
	hasNumber
 
=
 
new
 
Regex
  %
(
% &
$str
& /
)
/ 0
;
0 1
var
‘‘ 
hasUpperChar
‘‘ 
=
‘‘ 
new
‘‘ "
Regex
‘‘# (
(
‘‘( )
$str
‘‘) 2
)
‘‘2 3
;
‘‘3 4
var
’’ 
hasLowerChar
’’ 
=
’’ 
new
’’ "
Regex
’’# (
(
’’( )
$str
’’) 2
)
’’2 3
;
’’3 4
var
““ 

hasSymbols
““ 
=
““ 
new
““  
Regex
““! &
(
““& '
$str
““' C
)
““C D
;
““D E
return
•• 
password
•• 
.
•• 
Length
•• "
>=
••# %
$num
••& '
&&
–– 
	hasNumber
–– 
.
–– 
IsMatch
–– $
(
––$ %
password
––% -
)
––- .
&&
—— 
hasUpperChar
—— 
.
——  
IsMatch
——  '
(
——' (
password
——( 0
)
——0 1
&&
˜˜ 
hasLowerChar
˜˜ 
.
˜˜  
IsMatch
˜˜  '
(
˜˜' (
password
˜˜( 0
)
˜˜0 1
&&
™™ 

hasSymbols
™™ 
.
™™ 
IsMatch
™™ %
(
™™% &
password
™™& .
)
™™. /
;
™™/ 0
}
šš 	
}
›› 
}œœ 